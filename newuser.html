<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>New User | BlockCycle</title>
<link rel="stylesheet" href="style.css">
</head>
<body class="login-body">

<div class="login-container">
  <div class="login-card">
    <h1>♻️ BlockCycle</h1>
    <p class="subtitle">New User Registration</p>

    <form onsubmit="register(event)">
      <label>Register As</label>
      <select id="role" required>
        <option value="">Select Role</option>
        <option value="user">User</option>
        <option value="collector">Collector</option>
        <option value="authority">Authority</option>
        <option value="recycler">Recycler</option>
      </select>

      <label>Full Name</label>
      <input type="text" id="name" required>

      <label>Email</label>
      <input type="email" id="email" required>

      <label>Wallet Address (Blockchain)</label>
      <input type="text" id="wallet" placeholder="0x..." required>

      <label>Create Password</label>
      <input type="password" id="password" required>

      <button type="submit">Register</button>
    </form>

    <div class="divider">OR</div>

    <button class="btn-google" onclick="googleSignUp()">
      <img src="https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_Logo.svg" alt="Google">
      Sign up with Google
    </button>

    <p class="note">
      Already registered? <a href="login.html">Login</a>
    </p>
  </div>
</div>

<script>
async function googleSignUp() {
  const role = document.getElementById("role").value;
  if (!role) {
    alert("Please select a role first to sign up with Google");
    return;
  }
  
  const mockUser = {
    name: "Google User",
    email: "user@google.com",
    role: role,
    wallet: "0xMockGoogleWallet" + Math.floor(Math.random() * 1000),
    password: "google_password"
  };

  const response = await fetch('register.php', {
    method: 'POST',
    body: JSON.stringify(mockUser)
  });
  
  const result = await response.json();
  if(result.success) {
    localStorage.setItem("currentUser", JSON.stringify(mockUser));
    alert("Registered and Signed in successfully with Google as " + role);
    window.location.href = role + ".html";
  } else {
    alert(result.message);
  }
}

async function register(e){
  e.preventDefault();

  const data = {
    role: document.getElementById('role').value,
    name: document.getElementById('name').value,
    email: document.getElementById('email').value,
    wallet: document.getElementById('wallet').value,
    password: document.getElementById('password').value
  };

  const response = await fetch('register.php', {
    method: 'POST',
    body: JSON.stringify(data)
  });

  const result = await response.json();
  if(result.success) {
    alert("Registration successful");
    location.href="login.html";
  } else {
    alert(result.message);
  }
}
</script>

</body>
</html>
