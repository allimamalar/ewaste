<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blockchain Ledger | BlockCycle</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        .ledger-container {
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
        }
        .search-bar {
            width: 100%;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #ddd;
            margin-bottom: 30px;
            font-size: 1rem;
        }
        .hash-link {
            color: #2e8b57;
            text-decoration: none;
            font-family: monospace;
        }
    </style>
</head>
<body style="background: #f8fafc;">

    <header style="background: white; padding: 20px 50px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
        <h2 style="color: #2e8b57; margin: 0;">‚ôªÔ∏è BlockCycle Ledger</h2>
        <nav>
            <a href="index.html" style="color: #666; text-decoration: none; font-weight: 600; margin-left: 30px;">Home</a>
            <a href="login.html" style="color: #666; text-decoration: none; font-weight: 600; margin-left: 30px;">Login</a>
        </nav>
    </header>

    <div class="ledger-container">
        <div class="card">
            <h1>Immutable Public Ledger üåê</h1>
            <p>Real-time transparency for every e-waste lifecycle event. Verified by Blockchain.</p>
            <input type="text" class="search-bar" placeholder="Search by Transaction Hash, Wallet, or Device ID..." onkeyup="filterLedger(this.value)">
            
            <table>
                <thead>
                    <tr>
                        <th>Block Hash</th>
                        <th>Event Type</th>
                        <th>Device ID</th>
                        <th>Wallet / Email</th>
                        <th>Price (USD)</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="ledgerBody">
                    <!-- Data will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        function loadLedger() {
            const publicLedger = JSON.parse(localStorage.getItem('blockchain_ledger')) || [];
            const tbody = document.getElementById('ledgerBody');
            tbody.innerHTML = '';

            publicLedger.slice().reverse().forEach(s => {
                tbody.innerHTML += `
                    <tr>
                        <td><a href="#" class="hash-link">${s.blockchainHash}</a></td>
                        <td><strong>${getEventType(s.status)}</strong></td>
                        <td>${s.id}</td>
                        <td><small>${s.userEmail ? anonymizeEmail(s.userEmail) : 'N/A'}</small></td>
                        <td><strong>$${s.price || '0'}</strong></td>
                        <td><span class="badge badge-${s.status.toLowerCase()}">${s.status}</span></td>
                    </tr>
                `;
            });
        }

        function getEventType(status) {
            if(status === 'Submitted') return 'Asset Creation';
            if(status === 'Verified') return 'Pre-check Confirmed';
            if(status === 'Approved') return 'Authority Approval';
            if(status === 'Processing') return 'Recycling Started';
            if(status === 'Recycled') return 'Lifecycle Completion';
            return 'State Update';
        }

        function anonymizeEmail(email) {
            const [name, domain] = email.split('@');
            return name.substring(0, 3) + '...@' + domain;
        }

        function filterLedger(query) {
            const rows = document.querySelectorAll('#ledgerBody tr');
            query = query.toLowerCase();
            rows.forEach(row => {
                const text = row.innerText.toLowerCase();
                row.style.display = text.includes(query) ? '' : 'none';
            });
        }

        window.onload = loadLedger;
    </script>

</body>
</html>
